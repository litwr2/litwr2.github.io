<head>
<meta charset=utf-8>
<title>Emotional stories about processors for first computers: part 3 (Motorola 68k)</title>
<meta name=keywords content="CPU,processor,computer,history,Intel,DEC,PDP-11,VAX-11,8086,x86,hardware,GNU">
<link rel=stylesheet type=text/css href=style.css>
</head>

<body>
<h2>Motorola: from 68000 to 68040</h2>

<p>Motorola was the only company that could successfully compete with Intel in the field of production of processors for personal computers for some time.  In 1980, Motorola actually put Intel in a situation of crisis, from which it could only get out of by mobilizing all its forces and organizing the crush group for its competitors, whose actions somewhat violated the US antitrust laws.

<p>The 68000 was released in 1979 and at the first impression looked much better than the 8086.  It had 16 32-bit registers (more accurately, even 17), a separate command counter and a state register.  It could address 16 MB of memory directly which did not create any restrictions for example for large arrays.  However careful analysis of features of the 68000 shows that not everything was as good as it seemed.  In those years to have a memory of more than 1 MB was an unattainable luxury even for medium-sized organizations.  The 68000 code density was worse than for 8086, which means that 68000 code with the same functionality occupied more space.  The latter is also due to the fact that any instruction for the 68k processors should be multiples of 2 bytes in length, and for the x86 of 1 byte.  But the information about the code density is controversial as there is evidence showing that in some cases the 68000 could have the better code density.  Out of 16 registers of the 68k there are 8 address registers, which in some respect are slightly more advanced analogues of the x86 segment registers.  The ALU and data bus are 16-bit, so operations with 32-bit data are slower than someone could expect.  The execution time of register-register operations for the 68000 is 4 cycles, and for the 8086 it is only 2.  Computers based on the 68000 until the mid-80's were much more expensive than those based on the Intel 8088, but the 68000 could not work with virtual memory and did not have hardware support for working with real numbers, which made it unsuitable for use in the most advanced systems.  To support the use of virtual memory, another processor was required, usually another 68000 was used for this.  In 1982, as Bill Joy noted, Sun began developing their processor because the 68000 did not meet customer needs for performance, and especially for working with real numbers.  Interestingly, because of the large size of the 68000, Motorola people called it the "Texas cockroach".

<p>However, the larger size allowed more functionality to be squeezed in.  For example, the 68000 can handle up to 8 external interrupts without an external controller.  The x86 architecture, on the contrary, requires an external interrupt controller (the only very special exception is the 80186).  The data and address buses of the 68000 are not multiplexed, unlike the 8086.  Only with the 80286, Intel abandoned such multiplexing which is slowing computer systems.

<p>As always with products from Motorola the architecture of the 68000 shows some clumsiness and contrived oddities.  For example there are two stacks and two carry flags (one for condition checks and another for operations).  The oddities with the flags do not end with that.  For some reason many instructions including even MOVE zero the carry and overflow flags.  Another oddity is that the command to save the state of arithmetic flags which worked normally with the 68000, was made privileged in all processors starting with the 68010.  Some operations irritate by their non-optimization, for example, the CLR instruction of writing zero to memory is slower than writing a constant 0 to memory with the MOVE instruction or shift to the left is slower than adding an operand to itself.  There are some almost unnecessary commands, for example there are both arithmetic and logical shifts to the left.  Even the address registers while seemingly superior to the 8086 segment registers have a number of annoying disadvantages.  For example they need to load as much as 4 bytes instead of 2 for the 8086 and of these four, one was extra.  The 68000 command system reveals many similarities with the PDP-11 command system developed back in the 60's although some addressing methods and byte order are almost certainly taken from the IBM/370.  Addressing via base and index registers is done on the 68000 at the level of the 8-bit 6800 or Z80, with a single-byte offset &ndash; this is somehow completely impractical.  On the 8086 offsets are 16 bits, on the ARM or IBM/370 &ndash; 12.  Even the 6502 can use a 16-bit offset along with indexing.

<p>The codes for the 68k look somewhat more cumbersome and clumsy compared to the x86 or ARM.  On the other hand the 68000 is faster than the 8086, according to my estimates by about 20-30%.  The 680x0's code also has its inherent special beauty, elegance and less mechanicality than the x86's.  Additionally as shown by <a href="http://eab.abime.net/">eab.abime.net</a> experts, the code density of the 68k is often better than that of the x86.

<p>Overall the 68000 is a good processor with a large instruction set.  It was originally planned for use in minicomputers, not personal computers.  It is for the 68000 that the development of workstations by Sun, Apollo, HP, Silicon Graphics and later NeXT began.  Apple, which made the workstation-class Lisa computer, could also be added to this list.  The 68000 was used in many of the now legendary personal computers: the first Apple Macintosh computers that were produced before the early 90's, the first Commodore Amiga multimedia computers, and in relatively inexpensive and high-quality Atari ST computers.  The 68000 was also used in relatively inexpensive computers working with Unix variants, in particular in the rather popular Tandy 16B.  Interestingly IBM simultaneously led the development of the PC and the System 9000 computer based on the 68000, which was released less than a year after the PC.

<div align=center>
<p><img src=https://habrastorage.org/webt/bb/6q/iu/bb6qiuatbww6hvwaqzjs5gzv6oi.jpeg width=50%>
<p style=font-size:90%>The Apple Lisa &ndash; it's strange that the first 68000-based Apple computers (the Lisa and Macintosh) had black-and-white graphics, whereas the eight-bit Apple II computers had colors
</div>
<div align=center>
<p><img src=https://habrastorage.org/webt/7p/1w/bv/7p1wbvftf4q8trooqzrsxk57wq0.gif>
<p style=font-size:90%>This is a famous demo for the Amiga 1000, such graphics in 1985 seemed incredible fantasy. This is an image in GIF format, which allows you to show only 256 colors out of 4096 displayed by the real Amiga â€“ other formats for full-color animated graphics have still not been well supported
</div>

<p>The 68010 appeared clearly belatedly only in 1982 at the same time when Intel released the 80286, which put personal computers on the same level as a mini-computer.  The 68010 is pin-compatible with the 68000 but the system of its instructions is slightly different, so the replacement of the 68000 by 68010 has not become popular.  This incompatibility was caused by a contrived reason to bring the 68000 into more correspondence with the ideal theory of virtualization. The 68010 is only slightly no more than 10% faster than the 68000.  Obviously the the 68010 was badly losing to the 80286 and was even weaker than the 80186 that appeared in the same year.  Like the 80186 the 68010 almost never found a use in personal computers.

<p>The 68008 was also released in 1982 probably with a hope of repeating the success of the 8088. It's the 68000 but with an 8-bit data bus which allowed it to be used in cheaper systems. But the 68008 like the 68000 does not have an instruction queue which makes it about 50% slower than the 68000. Thus the 68008 may even be a little slower than the 8088, which is only about 20% slower than the 8086 due to the presence of the instruction queue.  IBM offered to make the Motorola 68008 by 1980, but then were refused, although it would have cost, according to Motorola employees, the work of one employee for less than a month.  If the refusal had not occurred, it was possible that IBM would have chosen the 68008 for the IBM PC.

<p>Based on the 68008 Sir Clive Sinclair made the Spectrum QL, a very interesting computer that because of the lower price could compete with the Atari ST and similar computers.  But Clive in parallel and clearly prematurely began to invest a lot in the development of electric vehicles leaving the QL (Quantum Leap) rather as a secondary task, that in the presence of some unsuccessful constructive decisions led the computer and the whole company to premature closure.  The company became part of Amstrad, which refused to produce QL.

<p>It would be interesting to calculate the bit index for the 68000, which seems to me clearly higher than 16 although maybe it is not higher than 24.

<p>Appearing in 1984 the 68020 again returned Motorola to the first position.  In this processor many very interesting and promising innovations were realized.  The strongest effect is certainly the instruction pipeline, which sometimes allows you to execute up to three instructions at once! The 32-bit address bus looked a little premature in those years, and therefore a cheaper version of the processor (the 68020EC) with a 24-bit bus was available, but the 32-bit data bus looked quite appropriate and allowed to significantly speed up the processor.  The built-in cache appeared to be an innovation even though it had a small 256 bytes of capacity, which allowed it sometimes to significantly improve the performance because the main dynamic memory could not keep up with the processor.  Although in the general case, such a small cache only slightly affected the performance.  Quick enough operations for division (64/32 = 32,32) and multiplication (32*32 = 64) for approximately 80 and up to 45 cycles respectively were added.  The timings of the instructions were generally improved for example the division (32/16 = 16,16) began to be performed for approximately 45 cycles (more than 140 cycles in the 68000).  Some instructions in the most favorable cases can be performed without occupying clocks at all!  New address modes were added  in particular with scaling, in the x86 this mode appeared only in the next year with the 80386.  Other new address modes allow the use of double indirect addressing using several offsets, the PDP-11 has been remarkably outdone here.

<p>Some new instructions for example bulky operations with bit fields or new operations with decimal numbers that have become little needed in the presence of rapid division and multiplication looked more like a fifth wheel of a bus than something essentially useful.  Address modes with double indirect addressing theoretically look interesting but practically are needed quite rarely and are executed very slowly.  Unlike the 80286 the 68020 takes time to compute the address of the operand, the so-called effective address.  The division at the 68020 is still almost twice as slow as the fantastic division of the 80286.  Multiplication and some other operations are also slower.  The 68020 doesn't have a built-in memory management unit and the rather exotic ability to connect up to eight coprocessors couldn't fix this.  The chief architect of the 68000 himself admitted that too many addressing modes were made in the 68020 and that the result was therefore some kind of monster.  They focused on the VAX and the ease of assembly programming, but the future came with RISC, higher speeds and powerful compilers.  In addition, here's another quote from Bill Joy: "It became clear that Motorola was doing with their microprocessor line roughly the same mistakes that DEC had done with their microprocessor line, in other words, 68010 68020 68040, were getting more and more complicated.  And they were slipping and they weren't getting faster anywhere near the rate that the underlying transistors were getting faster".

<p>The 68020 was widely used in mass computers the Apple Macintosh II, Macintosh LC and Commodore Amiga 1200, it was also used in several Unix systems.

<p>The appearance of the 80386 with a built-in and very well-made MMU and 32-bit buses and registers again put Motorola in position number 2.  The 68030 appearing in 1987 for the last time briefly returned the leadership to Motorola.  The 68030 has a built-in memory management unit and a doubled cache, divided into a cache for instructions and data, it was a very prospective novelty.  In addition the 68030 could use a faster memory access interface which can speed up memory operations by almost a third.  However, in general, working with memory remained slow &ndash; 4 clock cycles per access, i.e. the number of clock cycles remained the same as for the 68000.  It was even joked about as "Motorola's standard memory cycle".  For comparison, the 80286 took 2 clock cycles, while the ARM took 1.  Despite all the innovations the 68030 turned out to be somewhat slower than the 80386 at the same frequency.  However the 68030 was available at frequencies up to 50 MHz, and the 80386 only up to 40 MHz, which made top systems based on the 68030 slightly faster.  Shortcomings in the architecture of the 68k processors forced major manufacturers of computers based on these processors to look for a replacement.  Sun started producing its own SPARC processors, Silicon Graphics switched to the MIPS processors, Apollo developed its own PRISM processor, HP started using its own PA-RISC processors, and Apple was coerced to switch to the PowerPC processors.  Interestingly, Apple was going to switch to the SPARC in the second half of the 80's, but negotiations with Sun failed.

<p>The 68030 was used in computers of the Apple Macintosh II series, Commodore Amiga 3000, Atari TT, Atari Falcon and some others.

<p>With the 68040 Motorola once again tried to outperform Intel, this processor appeared a year later after the 80486. However the 68040's set of useful qualities was never able to surpass the 80486's.  In fact Motorola having a more overloaded system of instructions was not able to support it, and in a sense has disappeared from the race.  In the 68040 only a very truncated coprocessor could be placed to work with real numbers, and the chip itself was heated significantly more than the 80486.  According to the results on lowendmac.com/benchmarks, the 68040 only about 2.1 times faster than the 68030 which means that the 68040 is slightly slower than the 80486 at the same frequency.  The 68040 almost did not find applications in popular computers. Some noticeable use was found only by its cheaper version the 68LC040 which does not have a built-in coprocessor.  However the first versions of this chip had a serious hardware defect which did not allow using even the software emulation of the coprocessor!

<p>Motorola always had problems with mathematical coprocessors.  As was mentioned above Motorola never released such a coprocessor for the 68000/68010, while Intel had released its very successful 8087 since 1980.  To get a significant performance boost the code for the 68882 needs to be compiled differently than for the 68881.

<p>It is appropriate to say that the Intel x86 still has problems with the mathematical coprocessor.  The accuracy of calculations of some functions, for example the sine of some arguments, is very small, sometimes no more than 4 digits.  Therefore modern compilers often calculate such functions without using the services of the coprocessor.

<p>Edited by Richard BN
<hr>
<a href=https://litwr.livejournal.com/789.html>mirror</a>
</body>

